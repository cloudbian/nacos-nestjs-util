{
  "name": "nacos-nestjs-util",
  "version": "1.0.8",
  "description": "1.注册服务时，如果服务器设置了环境变量HOST_IP和EXPOSED_PORT，那么会把HOST_IP和EXPOSED_PORT作为服务的IP和PORT进行注册。 2.如果服务器没有设置环境变量，那么自动获取服务器IP以及本地.env配置的PORT作为服务的IP和PORT进行注册。 ## 介绍 本工具基于NestJs8.0以及nacos2.2.1，用于微服务中服务发现注册，注销，以及访问服务等。 ## 要求 1. 需要开启nest框架中的shutdownHooks,再应用的生命周期中做注册以及注销。 2. 设置globalPrefix需要和注册的服务名称一致（被调用的服务一样，context-path也需要与服务名一致） 3. 注册服务的端口号和应用的端口号一致 ## 使用 1. 安装 ``` >npm install nacos-nestjs-util --save >npm install nacos --save ``` 2. 在.env文件中增加如下配置,注意：NestJs获取.env文件需要添加ConfigModule，具体参考官方文档 ```示例 DISCOVERY_SERVERLIST = 192.168.56.101:1234 #配置nacos服务地址 DISCOVERY_NAMESPACE = public #配置nacos的空间名称（服务也是注册到此空间） DISCOVERY_GROUP = UAT #配置nacos的分组名称 DISCOVERY_APPNAME = node-service #本服务名称 PORT = 3000 #本服务端口号 HTTP_PREFIX = http:// #访问URI的前缀 ``` 3. 开启shutdownHooks ```javascript   app.enableShutdownHooks(); ``` 4. 配置全局前缀以及端口号 ```javascript   app.setGlobalPrefix(process.env.DISCOVERY_APPNAME); //请求前缀   await app.listen(process.env.PORT); ``` 5. 在根module导入HookModule ```javascript imports:[HookModule] ```",
  "author": "cloudbian",
  "private": false,
  "license": "MIT",
  "main": "dist/index",
  "scripts": {
    "prebuild": "rimraf dist",
    "build": "nest build",
    "format": "prettier --write \"src/**/*.ts\" \"test/**/*.ts\""
  },
  "dependencies": {
    "@nestjs/common": "^8.0.0",
    "@nestjs/core": "^8.0.0",
    "@nestjs/platform-express": "^8.0.0",
    "nacos": "^2.2.1",
    "reflect-metadata": "^0.1.13",
    "rimraf": "^3.0.2",
    "rxjs": "^7.2.0"
  },
  "devDependencies": {
    "@nestjs/cli": "^8.0.0",
    "@nestjs/schematics": "^8.0.0",
    "@nestjs/testing": "^8.0.0",
    "@types/express": "^4.17.13",
    "@types/jest": "^26.0.24",
    "@types/node": "^16.0.0",
    "@types/supertest": "^2.0.11",
    "@typescript-eslint/eslint-plugin": "^4.28.2",
    "@typescript-eslint/parser": "^4.28.2",
    "eslint": "^7.30.0",
    "eslint-config-prettier": "^8.3.0",
    "eslint-plugin-prettier": "^3.4.0",
    "jest": "27.0.6",
    "prettier": "^2.3.2",
    "supertest": "^6.1.3",
    "ts-jest": "^27.0.3",
    "ts-loader": "^9.2.3",
    "ts-node": "^10.0.0",
    "tsconfig-paths": "^3.10.1",
    "typescript": "^4.3.5"
  },
  "jest": {
    "moduleFileExtensions": [
      "js",
      "json",
      "ts"
    ],
    "rootDir": "src",
    "testRegex": ".*\\.spec\\.ts$",
    "transform": {
      "^.+\\.(t|j)s$": "ts-jest"
    },
    "collectCoverageFrom": [
      "**/*.(t|j)s"
    ],
    "coverageDirectory": "../coverage",
    "testEnvironment": "node"
  },
  "directories": {
    "test": "test"
  },
  "keywords": [
    "nacos",
    "nestjs"
  ],
  "types": "./dist\\index.d.ts"
}
